#!/usr/bin/env node
import { f as i, r as o, ba as n, s as p, p as c } from "./color-Bf2jGwiV.js";
const u = o.pipe(
  p(({ settings: e, secrets: t }) => c(async () => await t.getToken("apiKey", e.url) !== void 0))
);
async function w(e, t) {
  const r = await i(o, t?.signal ?? void 0);
  return f(r, e, t);
}
async function f(e, t, r) {
  if (t.startsWith("http:") || t.startsWith("https:"))
    throw new Error("input must be a path, not an absolute URL");
  if (!t.startsWith("/"))
    throw new Error("pathAndQuery must start with /");
  const s = e.settings.url;
  if (!s)
    throw new Error("amp.url is not set");
  const a = await e.secrets.getToken("apiKey", s);
  if (!a)
    throw new Error("Amp API key is not set");
  return fetch(new URL(t, s), {
    ...r,
    headers: {
      ...r?.headers,
      ...n(),
      "Content-Type": "application/json",
      Authorization: `Bearer ${a}`
    }
  });
}
export {
  w as f,
  u as i
};
//# sourceMappingURL=client-DfrJv231.js.map
